/**
 * ****************************************************
 * @Copyright (c) 2018, Spell Master.
 * @version 1.0
 * @requires  Navegador compatível com HTML 5
 * ****************************************************
 * @class Executa ajax para processamento de arquivos.
 * ****************************************************
 */
var FileTransfer=function(){var e,n,o,r,t,l,s,i,d,a,c,u,p=[];function v(){(l=document.createElement("div")).id="transfer-progress",l.innerHTML='<div class="progress-text"></div><div class="progress-file"></div><div class="progress-percent"></div><div class="progress-line"><div class="progress-bar"></div></div>',r&&(l.innerHTML+='<button class="progress-cancel">Cancelar</button>',l.querySelector(".progress-cancel").addEventListener("click",q,!1)),document.body.appendChild(l)}function f(){"upload"===t?l.querySelector(".progress-text").innerText="Enviando Arquivo":"download"===t&&(l.querySelector(".progress-text").innerText="Transferindo Arquivo"),l.querySelector(".progress-file").innerText=o,p[0]=l.querySelector(".progress-percent"),p[1]=l.querySelector(".progress-bar")}function m(e){var n;e.lengthComputable&&(n=Math.round(e.loaded/e.total*100),p[0].innerText=n+"% completado",p[1].style.width=n+"%")}function g(){404===e.status?(console.log("Não foi possível localizar o arquivo ("+o+")"),q()):4===e.readyState&&200===e.status&&(r&&(l.querySelector(".progress-cancel").style.display="none"),setTimeout(function(){i&&(a=e.responseText,function(){var n=document.getElementById(i);if(null!==n){n.innerHTML=e.responseText;var o,r,t,l,s,d=a.indexOf("<script",0),c=n.getElementsByTagName("script");for(s=c.length-1;s>=0;s--)c[s].parentNode.removeChild(c[s]);for(;-1!=d;)o=document.createElement("script"),r=a.indexOf(" src",d),d=a.indexOf(">",d)+1,r<d&&r>=0?(d=r+4,t=a.indexOf(".js",d)+3,l=(l=a.substring(d,t)).replace("=","").replace(" ","").replace('"',"").replace('"',"").replace("'","").replace("'","").replace(">",""),o.src=l):(t=a.indexOf("<\/script>",d),l=a.substring(d,t),o.text=l),n.appendChild(o),d=a.indexOf("<script",t),o=null}else console.warn('Não é possível determinar sucesso do envio, elemento de #ID de validação é "null"')}()),"upload"===t?y():"download"===t&&(c=window.URL.createObjectURL(e.response),(u=document.createElement("a")).href=n,u.download=o,document.body.appendChild(u),u.click(),y())},1e3))}function y(){r&&l.querySelector(".progress-cancel").removeEventListener("click",q),"download"===t&&c&&(window.URL.revokeObjectURL(c),document.body.removeChild(u)),document.body.removeChild(l),x()}function x(){"upload"===t?(s=null,i=null,d=null):"download"===t&&(c=null,u=null),e=null,n=null,o=null,r=null,t=null,l=null,p=[]}function q(){e.abort(),y()}this.upload=function(l,a,c,u){return l?a?e instanceof XMLHttpRequest?console.log("Já existe um processo em andamento"):(e=new XMLHttpRequest,s=new FormData,r=!!u||null,i=c||null,t="upload",(d=document.getElementById(l).querySelector('input[type="file"]')).value?(n=d.files[0],o=n.name,s.append(d.name,n),v(),f(),e.upload.addEventListener("progress",m,!1),e.addEventListener("readystatechange",g,!1),e.responseType="text",e.open("POST","action.php",!0),e.send(s)):(x(),console.log("Nenhum arquivo selecionado"))):console.log("Arquivo de recebimento não expecificado"):console.log("ID do formulário não expecificado"),!1},this.download=function(l,s){if(l)if(e instanceof XMLHttpRequest)console.log("Já existe um processo em andamento");else{e=new XMLHttpRequest;var i=l.split("/").reverse();n=l,o=i[0],r=s||!1,t="download",v(),f(),e.addEventListener("progress",m,!1),e.addEventListener("readystatechange",g,!1),e.responseType="blob",e.open("GET",l,!0),e.send()}else console.log("Arquivo de envio não expecificado");return!1}};
